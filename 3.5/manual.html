<html>
<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex">
    <style type="text/css">
    	table.options {
    		padding-bottom: 1em;
    	}
    	table.options td {
    		padding: 0.3em 0.5em 0.3em 0;
    	}
    </style>
	<title>
		Mycodo 3.5 Manual
	</title>
</head>
<body>

<h1>Mycodo 3.5 Manual</h1>

<ul>
<li><a href="#preface">Preface</a></li>
<li><a href="#web-interface">Web Interface</a></li>
<ul>
	<li><a href="#graph-tab">Graph Tab</a></li>
	<ul>
		<li><a href="#generating-graphs">Generating Graphs</a></li>
		<li><a href="#automatic-refresh">Automatic Refresh</a></li>
	</ul>
	<li><a href="#sensor-tab">Sensor Tab</a></li>
	<ul>
		<li><a href="#relays">Relays</a></li>
		<li><a href="#sensors">Sensors</a></li>
		<li><a href="#timers">Timers</a></li>
		<li><a href="#conditional-statements">Conditional Statements</a></li>
		<li><a href="#discrete-pid-control">Discrete PID Control</a></li>
		<li><a href="#quick-set-up-examples">Quick Setup Examples</a></li>
		<ul>
			<li><a href="#exact-temperature-regulation">Exact-Temperature Regulation</a></li>
			<li><a href="#high-temperature-regulation">High-Temperature Regulation</a></li>
		</ul>
	</ul>
	<li><a href="#custom-tab">Custom Tab</a></li>
	<li><a href="#camera-tab">Camera Tab</a></li>
	<li><a href="#data-tab">Data Tab</a></li>
	<ul>
		<li><a href="#system-restore">System Restore</a></li>
	</ul>
	<li><a href="#settings-tab">Settings Tab</a></li>
	<ul>
		<li><a href="#system-update">System Update</a></li>
	</ul>
</ul>
<li><a href="#tips">Tips</a></li>
</ul>

<a name="preface"></a>
<h2>Preface</h2>

<p>There may be many unforseen issues with sending multiple commands when using the web interface. Therefore, wait for either a response or for the page to time out before pressing another button.</p>

<a name="web-interface"></a>
<h2>Web Interface</h2>

<p>Go to http://127.0.0.1/mycodo (replace 127.0.0.1 with the correct domain name or IP address) and log in with the credentials you created with update-database.py. You will be greeted by a header with various information about the currently-logged in user, the status of the daemon and other services, system performance statistics, and (if sensors are receiving data and activated) information about the activated sensors.</p>

<p><b>Many input fields and buttons of the web interface will display descriptions or instructions when the mouse is hovered over them. While a complete manual is being developed, utilize this to learn about the system.</b></p>

<p>The Daemon indicator at the top-left indicates the daemon is running (blue). If it is not (red), sensor measurements, logging, and PID regulation cannot operate.</p>

<p>Additionally, relays must be properly set up before PID regulation can be achieved. Add and configure relays in the Sensor tab. Set the "GPIO Pin" to the BCM number of the pin connected to the relay. "Signal ON" should be set to the signal that activates the relay (close the circuit). If your relay activates when the potential across the coil is 0-volts, set "Signal ON" to "Low", otherwise if your relay activates when the potential across the coil is 5-volts, set it to "High".</p>

<a name="graph-tab"></a>
<h3>Graph Tab</h3>

<p>This is the main landing page after logging in to Mycodo. It will look empty until sensors begin logging measurements and a graph can be generated of the historical data. See the <a href="#sensor-tab">Sensor Tab</a> for setting up sensors.</p>

<a name="generating-graphs"></a>
<h4>Generating Graphs</h4>

<p>There are two dropdown lists for selecting options for generating graphs. They define the type of graph and duration. The type of graph can be either Seperate or Combined. A Seperate graph will plot a new graph for each sensor. A Combined graph will plot a new graph for each measured condition. For example, A Seperate graph will plot both temperature and humidity from the data from a sensor that measures both temperature and humidity. A Combined graph will plot all temperateures on one graph and all humidities on another graph. The duration on x-axis can be chosen from a range of 1 hour to 6 months. If you desire a custom range, see the <a href="#custom-tab">Custom Tab</a>.</p>

<p>Note: To increase performance and reduce needless processing power, the generation of a graph will only occur under certain circumstances. Clicking "Refresh Page" or refreshing the page (without resubmitting form data) will not generate a graph. Clicking "Generate Graph" will always generate a graph. Enabling Auto Refresh on the Graph Tab will always generate a graph. Clearing cookies will cause a graph to generate the next time any page is loaded. If 20 graphs have been generated by other users, after your last graph generation, a new graph will generate on the next page load (regardless of how the page was reloaded).</p>

<a name="automatic-refresh"></a>
<h4>Automatic Refresh</h4>

<p>When activted, the Automatic Refresh option will force the page to refresh for the duration of time defined in the <a href="#settings-tab">Settings Tab</a>. If Auto Refresh was activated on the Graph Tab, the refreshed page will stay on the Graph Tab as well as generate a new graph from current measurement data.</p>

<a name="sensor-tab"></a>
<h3>Sensor Tab</h3>

<p>Here is where the configuration of relays, sensors, timers, PID controllers, and conditional statements will occur.

<a name="relays"></a>
<h4>Relays</h4>

<p>Relays are electromechanical or solid-state devices that enable a small voltage signal (such as from a microprocessor) to activate a much larger voltage, without exposing the low -voltage system to the dangers of the higher voltage.</p>

<a name="sensors"></a>
<h4>Sensors</h4>

<p>Sensors will acquire environmental measurements, which will be used to create historical logs and modulate relays on and off to regulate the environment.</p>

<table class="options">
	<tr>
		<td colspan="2" style="font-size: 1.15em;">Main Sensor Setup</td>
	</tr>
	<tr>
		<td>Option</td>
		<td>Description</td>
	</tr>
	<tr>
		<td>Name</td>
		<td>This is a unique name you can give this sensor, which will allow you to easily recognize it with a familiar name.</td>
	</tr>
	<tr>
		<td>Device</td>
		<td>If there is support for more than one of a particular type of sensor, select which sensor is being used.</td>
	</tr>
	<tr>
		<td>Serial Number or GPIO</td>
		<td>Depending on what sensor is being used, you will need to either enter the serial number (in the case of the DS18B20 temperature sensor) or the GPIO pin (in the case of the humidity/temperature sensors) connected to the sensor.</td>
	</tr>
	<tr>
		<td>Log Interval</td>
		<td>After the sensor is successfully read and a log entry is made, this is the duration of time that is waited until the sensor is measured again for a log entry.</td>
	</tr>
	<tr>
		<td>Pre Relay</td>
		<td>If you require a relay to be activated before a measurement is made (for instance, if you have a pump that extracts air to a chamber where the sensor resides), this is the relay number that will be activated. The relay will be activated for a duration defined by the Pre Duration, then once the relay turns off, a measurement by the sensor is made.</td>
	</tr>
	<tr>
		<td>Pre Duration</td>
		<td>This is the duration of time that the Pre Relay runs for before the sensor measurement is obtained.</td>
	</tr>
	<tr>
		<td>Log</td>
		<td></td>
	</tr>
	<tr>
		<td>Graph</td>
		<td></td>
	</tr>
	<tr>
		<td>Presets</td>
		<td></td>
	</tr>
	<tr>
		<td>Load</td>
		<td></td>
	</tr>
	<tr>
		<td>Save</td>
		<td></td>
	</tr>
	<tr>
		<td>Delete</td>
		<td></td>
	</tr>
	<tr>
		<td>New</td>
		<td></td>
	</tr>
	<tr>
		<td>Rename</td>
		<td></td>
	</tr>
</table>

<table class="options">
	<tr>
		<td colspan="2" style="font-size: 1.15em;">Sensor Verification</td>
	</tr>
	<tr>
		<td>GPIO</td>
		<td>This is the GPIO pin of the sensor that will be used to verify the sensor measurement. The sensor of this GPIO will be read directly after the first sensor's measurement to verify whether the sensors have similar measurements.</td>
	</tr>
	<tr>
		<td>Temperature Difference</td>
		<td>This is the maximum measured temperature difference between the two sensors before an action is triggered (either notify by email or prevent PID from operating; more below).</td>
	</tr>
	<tr>
		<td>Notify</td>
		<td>If the temperatures of the two sensors differ by more than the set Temperature Difference, an email will be sent to the address in the Notification field.</td>
	</tr>
	<tr>
		<td>Stop PID</td>
		<td>If the temperatures of the two sensors differ by more than the set Temperature Difference, and the Temperature PID controller is turned on, the PID will be prevented from updating and the PID relay will be prevented from turning on.</td>
	</tr>
	<tr>
		<td>Humidity Difference</td>
		<td>This is the maximum measured humidity difference between the two sensors before an action is triggered (either notify by email or prevent PID from operating; more below).</td>
	</tr>
	<tr>
		<td>Notify</td>
		<td>If the humidities of the two sensors differ by more than the set Temperature Difference, an email will be sent to the address in the Notification field.</td>
	</tr>
	<tr>
		<td>Stop PID</td>
		<td>If the humidities of the two sensors differ by more than the set Temperature Difference, and the Temperature PID controller is turned on, the PID will be prevented from updating and the PID relay will be prevented from turning on.</td>
	</tr>
	<tr>
		<td>Notification</td>
		<td>This is the email address that will be notified if the measurement differences surpass the set limit.</td>
	</tr>
</table>

<table class="options">
	<tr>
		<td colspan="2" style="font-size: 1.15em;">Graph Y-Axis Range & Marks</td>
	</tr>
	<tr>
		<td>Relay Min</td>
		<td></td>
	</tr>
	<tr>
		<td>Relay Max</td>
		<td></td>
	</tr>
	<tr>
		<td>Relay Tics</td>
		<td></td>
	</tr>
	<tr>
		<td>Relay mTics</td>
		<td></td>
	</tr>
	<tr>
		<td>Condition Min</td>
		<td></td>
	</tr>
	<tr>
		<td>Condition Max</td>
		<td></td>
	</tr>
	<tr>
		<td>Condition Tics</td>
		<td></td>
	</tr>
	<tr>
		<td>Condition mTics</td>
		<td></td>
	</tr>
	<tr>
		<td>Graph Up</td>
		<td></td>
	</tr>
	<tr>
		<td>Graph Down</td>
		<td></td>
	</tr>
</table>

<table class="options">
	<tr>
		<td colspan="2" style="font-size: 1.15em;">PID Regulation</td>
	</tr>
	<tr>
		<td>Activate</td>
		<td>Turn a particular PID controller on or off.</td>
	</tr>
	<tr>
		<td>Set Point</td>
		<td>This is the specific point you would like the environment to be regaulted at.</td>
	</tr>
	<tr>
		<td>Regulate</td>
		<td>This is the direction that you wish to regulate. For instance, if you only require the temperature to be raised, set this to "Up," but if you require regulation up and down, set this to "Both."</td>
	</tr>
	<tr>
		<td>Measure Interval</td>
		<td>This is the duration between when the PID relay turns off amd when the sensor takes another measurement, the PID is updated, and the relay is turned on again for another duration.</td>
	</tr>
	<tr>
		<td>Up Relay</td>
		<td>This is the relay that will cause the particular environmental condition to rise. In the case of raising the temperature, this may be a heating pad or coil.</td>
	</tr>
	<tr>
		<td>Up Min</td>
		<td>This is the minimum that the PID output must be before the Up Relay turns on. If the PID output exceeds this minimum, the Up Relay will turn on for the PID output number of seconds.</td>
	</tr>
	<tr>
		<td>Up Max</td>
		<td>This is the maximum duration the Up Relay is allowed to turn on for. if the PID output exceeds this number, the Up Relay will turn on for no greater than this duration of time.</td>
	</tr>
	<tr>
		<td>Down Relay</td>
		<td>This is the relay that will cause the particular environmental condition to lower. In the case of lowering the CO<sub>2</sub>, this may be an exhaust fan.</td>
	</tr>
	<tr>
		<td>Down Min</td>
		<td>This is the minimum that the PID output must be before the Down Relay turns on. If the PID output exceeds this minimum, the Down Relay will turn on for the PID output number of seconds.</td>
	</tr>
	<tr>
		<td>Down Max</td>
		<td>This is the maximum duration the Down Relay is allowed to turn on for. if the PID output exceeds this number, the Down Relay will turn on for no greater than this duration of time.</td>
	</tr>
	<tr>
		<td>Kp</td>
		<td></td>
	</tr>
	<tr>
		<td>Ki</td>
		<td></td>
	</tr>
	<tr>
		<td>Kd</td>
		<td></td>
	</tr>
</table>

<a name="timers"></a>
<h4>Timers</h4>

<p>Timers enable a relay to be switched on and off at specific durations. Both the on duration and the off duration can be defined and the timer can be turned on and off at will. Nothing fancy yet.</p>

<a name="conditional-statements"></a>
<h4>Conditional Statements</h4>

<p>A conditional statement is a way to perform certain actions based on whether a condition is true. Conditional statements can be created for both relays and sensors. Possible conditional statements include:</p>

<p>
If relay #1 turns on, turn relay #3 on<br>
If relay #1 turns off, turn relay #3 off<br>
If relay #1 turns on, turn relay #4 on for 40 seconds and notify critical-issue@domain.com<br>
If relay #2 turns on, turn relay #4 on for 21 seconds<br>
If relay #4 turns on for 21 seconds, turn relay #5 on for 50 seconds<br>
If relay #4 turns on for 20 seconds, turn relay #1 off<br>
If Humidity is Greater Than 80%, turn relay #4 on for 40 seconds<br>
If Humidity if Less Than 50%, turn relay #1 on for 21 seconds, execute '/usr/local/bin/myscript.sh', and notify minor-issue@domain.com<br>
</p>

<p>Before activating any conditional statements or PID controllers, it"s advised to thoroughly explore all possible scenarios and plan a configuration that eliminates conflicts. Then, trial run your configuration before connecting devices to the relays. Some devices or relays may respond atypically or fail when switched on and off in rapid succession. Therefore, avoid creating an <a href="https://en.wikipedia.org/wiki/Loop_%28computing%29#Infinite_loops" target="_blank">infinite loop</a> with conditional statements.</p>

<a name="discrete-pid-control"></a>
<h4>Discrete PID Control</h4>

<p>The PID controller is the most common regulatory controller found in industrial settings, for it"s ability to handle both simple and complex regulation. The PID controller has three paths, the proportional, integral, and derivative.</p>

<p>The <b>P</b>roportional takes the error and multiplies it by the constant K<sub>p</sub>, to yield an output value. When the error is large, there will be a large proportional output.</p>

<p>The <b>I</b>ntegral takes the error and multiplies it by K<sub>i</sub>, then integrates it (K<sub>i</sub> · 1/s). As the error changes over time, the integral will continually sum it and multiply it by the constant K<sub>i</sub>. The integral is used to remove perpetual error in the control system. If using K<sub>p</sub> alone produces an output that produces a perpetual error (i.e. if the sensor measurement never reaches the Set Point), the integral will increase the output until the error decreases and the Set Point is reached.</p>

<p>The <b>D</b>erivative multiplies the error by K<sub>d</sub>, then differentiates it (K<sub>d</sub> · s). When the error rate changes over time, the output signal will change. The faster the change in error, the larger the derivative path becomes, decreasing the output rate of change. This has the effect of dampening overshoot and undershoot (oscillation) of the Set Point.</p>

<p><a href="https://en.wikipedia.org/wiki/PID_controller" target="_blank"><img src="http://kylegabriel.com/images/PID_Animated.gif"></a></p>

<p>Using temperature as an example, the Process Variable (PV) is the sensed temperature, the Set Point (SP) is the desired temperature, and the Error (e) is the distance between the measured temperature and the desired temperature (indicating if the actual temperature is too hot or too cold and to what degree). The error is manipulated by each of the three PID components, producing an output, called the Manipulated Variable (MV) or Control Variable (CV). To allow control of how much each path contributes to the output value, each path is multiplied by a gain (represented by K). By adjusting the gains, the sensitivity of the system to each path is affected. When all three paths are summed, the PID output is produced. If a gain is set to 0, that path does not contribute to the output and that path is eessentially turned off.</p>

<p>The output can be used a number of ways, however this controller was designed to use the ouput to affect the sensed value (PV). This feedback loop, with a <i>properly tuned</i> PID controller, can achieve a set point in a short period of time, maintain regulation with little oscillation, and respond quickly to disturbance.</p>

<p>Therefor, if one would be regulating temperature, the sensor would be a temperature sensor and the feedback device(s) would be able to heat and cool. If the temperature is lower than the Set Point, the output value would be positive and a heater would activate. The temperature would rise toward the desired temperature, causing the error to decrease and a lower output to be produced. This feedback loop would continue until the error reaches 0 (at which point the output would be 0). If the temperature continues to rise past the Set Point (this is may be aceptable, depending on the degree), the PID would produce a negative output, which could be used by the cooling device to bring the temperature back down, to reduce the error. If the temperature would normally lower without the aid of a cooling device, then the system can be simplified by omitting a cooler and allowing it to lower on its own.</p>

<p>Implementing a controller that effectively utilizes P, I, and D can be challenging. Furthermore, it is often unnecessary. For instance, the I and D can be set to 0, effectively turning them off and producing the very popular and simple P controller. Also popular is the PI controller. It is recommended to start with only P activated, then experiment with PI, before finally using PID. Because systems will vary (e.g. airspace volume, degree of insulation, and the degree of impact from the connected device, etc.), each path will need to be adjusted through experimentation to produce an effective output.</p>

<a name="quick-set-up-examples"></a>
<h4>Quick Set-up Examples</h4>

<p>These example setups are meant to illustrate how to configure regulation in particular directions, and not to achieve ideal values to configure your P, I, and D variables. There are a number of online resources that discuss techniques and methods that have been developed to determine ideal PID values (such as <a href="http://robotics.stackexchange.com/questions/167/what-are-good-strategies-for-tuning-pid-loops" target="_blank">here</a>, <a href="http://innovativecontrols.com/blog/basics-tuning-pid-loops" target="_blank">here</a>, <a href="https://hennulat.wordpress.com/2011/01/12/pid-loop-tuning-101/" target="_blank">here</a>, <a href="http://eas.uccs.edu/wang/ECE4330F12/PID-without-a-PhD.pdf" target="_blank">here</a>, and <a href="http://www.atmel.com/Images/doc2558.pdf" target="_blank">here</a>) and since there are no universal values that will work for every system, it is recommended to conduct your own research to understand the variables and essential to conduct your own experiments to effectively implement them.</p>

<p>Provided merely as an example of the variance of PID values, one of my setups had temperature PID values (up regulation) of P=30, I=1.0, and D=0.5, and humidity PID values (up regulation) of P=1.0, I=0.2, and D=0.5. Furthermore, these values may not have been optimal but they worked well for the conditions of my environmental chamber.</p>

<a name="exact-temperature-regulation"></a>
<h4>Exact Temperature Regulation</h4>

<p>This will set up the system to raise and lower the temperature to a certain level with two regulatory devices (one that heats and one that cools).</p>

<p>Select the number of sensors that are connected. Select the proper device and GPIO pin for each sensor and activate logging and graphing.</p>

<p><b><i>Stop here. Wait 10 minutes, then go the Main tab and generate a graph. If the graph generates with data on it, continue. If not, stop and investigate why there is no sensor data. The PID controller will not function if there is not sensor data being acquired.</i></b></p>

<p>Under the Temperature PID for an active sensor, change "PID Set Point" to the desired temperature, "PID Regulate" to Both. Set the "Up Relay" to the relay number attached to the heating device and the "Down Relay" to the relay number attached to the coolong device.</p>

<p>Set "P" to 1, "I" to 0, "D" to 0, then turn the Temperature PID on with the ON button.</p>

<p>If the temperature is lower than the Set Point, the heater should activate at some interval determined by the PID controller until the temperature rises to the set point. If the temperature goes higher than the Set Point (or Set Point + Buffer), the cooling device will activate until the temperature returns to the set point. If the temperature is not reaching the Set Point after a reasonable amount of time, increase the P value and see how that affects the system. Experiment with different configurations involving only "Read Interval" and "P" to achieve a good regulation. Avoid changing the "I" and "D" from 0 until a working regulation is achieved with P alone.</p>

<p>Generate "6 Hour Seperate" graphs from the Main tab to identify how well the temperature is regulated to the Set Point. What is meant by well-regulated will vary, depending on your specific application and tolerances. Most applications of a PID controller would like to see the proper temperature attained within a reasonable amount of time and with little oscillation.</p>

<p>Once regulation is achieved, experiment by reducing P slightly (~25%) and increasing "I" by a low amount to start, such as 0.1 (or lower), then observe how the controller regulates. Slowly increase I until regulation becomes both quick yet there is little oscillation once regulation is achieved. At this point, you should be fairly familiar with experimenting with the system and the D value can be experimented with.</p>

<a name="high-temperature-regulation"></a>
<h4>High Temperature Regulation</h4>

<p>Often the system can be simplified if two-way regulation is not needed. For instance, if cooling is unnecessary, this can be removed from the system and only up-regulation can be used.</p>

<p>Use the same configuration as the <a href="#exact-temperature-regulation">Exact Temperature Regulation</a> example, except change "PID Regulate" to "Up" and do not touch the "Down Relay" section.</p>

<a name="custom-tab"></a>
<h3>Custom Tab</h3>

<p></p>

<a name="camera-tab"></a>
<h3>Camera Tab</h3>

<p></p>

<a name="data-tab"></a>
<h3>Data Tab</h3>

<p></p>

<a name="system-restore"></a>
<h4>System Restore</h4>

<p>You may restore a backup of Mycodo and bring it back to a previous version. This may be desirable if an update happens to break your system. To view all backups, use the "All Backups" button under the Data tab. If you would like to view the backups in the contact of github updates, use the "Git Commits" button under the data tab. When viewing git commits, existing backups will be displayed under the commit for which the system was at during the time of the backup.</p>

<p>To ensure no data is lost, when a backup is restored, a backup of the current system is also created.</p>

<a name="settings-tab"></a>
<h3>Settings Tab</h3>

<p></p>

<a name="system-update"></a>
<h4>System Update</h4>

<p>You may update Mycodo to the latest version with the "Update Mycodo" button under the Settings tab. A backup of the old system will be made to /var/Mycodo-backups/.</p>

<p>Note: All logs and databases will be preserved during the update process. If you wish to return to a previous backup, read the next section, System Restore.</p>

<a name="tips"></a>
<h2>Tips</h2>

<p>The page-load time when submiting configuration changes in the sensor tab will be faster when the daemon is not running. The daemon can be stopped and started in the Settings tab.</p>

</body>
</html>