{% extends "layout.html" %}
{% set active_page = "dependencies" %}
{% set help_page = ["dependencies", _('Dependencies')] %}

{% block title %} - {{_('Dependencies')}}{% endblock %}

{% block head %}{% endblock %}

{%- block body %}
  <!-- Route: /dependencies -->
  <div class="container">
    {% include 'flash_messages.html' %}

    <h4>{{_('Dependencies')}} <a href="/help#{{help_page[0]}}" target="_blank"><span style="font-size: 16px" class="glyphicon glyphicon-question-sign"></span></a></h4>
    <p>{{_('')}}</p>

  {% if device != '0' %}
    <h2>Device: {{device}}</h2>

    {% if device_unmet_dependencies %}
    <p>There were unmet dependencies encountered when adding the following device: {{device}}</p>
    <p>The Unmet dependencies are the following python modules:</p>
     <ul>
    {% for each_dep in device_unmet_dependencies %}
      <li>{{each_dep}}</li>
    {% endfor %}
    </ul>

    <p>To install these dependencies, click the Install button below and wait for the install to complete before attempting to add the device again.</p>

    <form method="post" action="/admin/dependencies/{{device}}">
      {{form_dependencies.csrf_token}}
      {{form_dependencies.device(class_='form-control', value=device)}}
      <div class="row">
        <div class="col-xs-12 col-sm-6 col-md-3">
          {{form_dependencies.install(class_='form-control btn btn-default')}}
        </div>
      </div>
    </form>
    {% else %}
    <p>All dependencies have installed to use this device.</p>
    {% endif %}

    <h5><a href="/admin/dependencies">Return to device list</a></h5>

  {% else %}

     {% if dep_tally %}
    <div style="padding-top:1.5em">
      <h4>List of unmet dependencies and the devices that require them</h4>
      {% for each_dep, devices in dep_tally.items() %}
      <div>
        {{each_dep}}: {%- for each_device in devices %}<a href="{{each_device}}">{{each_device}}</a>{% if not loop.last %} ,{% endif %}{% endfor %}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    {% if unmet_dependencies %}
    <div style="padding-top:1.5em">
      <h4>List of devices with unmet dependencies</h4>
      {% for each_device, dependencies in unmet_dependencies.items() if dependencies %}
      <div>
        <a href="{{each_device}}">{{each_device}}</a>: {%- for each_dep in dependencies %}{{each_dep}}{% if not loop.last %} ,{% endif %}{% endfor %}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    {% if met_dependencies %}
    <div style="padding-top:1.5em">
      <h4>List of devices that have all dependencies installed</h4>
      {% for each_device in met_dependencies %}
      <div>
        <a href="{{each_device}}">{{each_device}}</a>
      </div>
      {% endfor %}
    </div>
    {% endif %}

  {% endif %}

  </div>

{% endblock -%}
