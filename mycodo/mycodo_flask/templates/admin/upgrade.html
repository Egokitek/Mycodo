{% extends "layout.html" %}
{% set active_page = "update" %}
{% block title %} - Update{% endblock %}

{% block body %}
  <!-- Route: /admin/upgrade -->
  <div class="container"> 
    {% include 'flash_messages.html' %}
    <div style="padding-bottom: 1em">
      Mycodo may be upgraded to the latest release on github. An attempt will be made to detect your internet connection, and if one is found, the option to upgrade will be made available.
    </div>
    {% if updating %}
      <div style="padding-bottom: 1em">
        Mycodo is currently in the process of an update. If this is in error, you may delete the ~/Mycodo/.updating file to be able to reinitiate the update process.
      </div>
    {% elif not is_internet %}
      <div style="padding-bottom: 1em">
        No internet connection detected.
      </div>
    {% elif not update_available %}
      <div style="padding-bottom: 1em">
        No upgrade is available. You are running the latest version of Mycodo, version <a href="https://github.com/kizniche/Mycodo/releases/tag/v{{ current_release }}" target="_blank">{{ current_release }}</a>.
      </div>
    {% elif update_available %}
      <div style="padding-bottom: 1em">
        An newer version of Mycodo is available. You are running version <a href="https://github.com/kizniche/Mycodo/releases/tag/v{{ current_release }}" target="_blank">{{ current_release }}</a>, which is currently {{ releases_behind }} releases behind the latest version, <a href="https://github.com/kizniche/Mycodo/releases/tag/v{{ latest_release }}" target="_blank">{{ latest_release }}</a>. Refer to the <a href="https://github.com/kizniche/Mycodo/blob/master/CHANGELOG.md" target="_blank">Changelog</a> for what has been changed. Click the button below to begin the upgrade process.
      </div>
      <div class="form-inline" style="padding-bottom: 1em">
        <form method="post" action="/admin/upgrade">
          <input type="hidden" name="form-name" value="update">
          {{formUpdate.csrf_token}}
          <div>
            <div class="form-group">
              {{formUpdate.update(class_='form-control')}}
            </div>
          </div>
        </form>
      </div>
      <div style="font-family: 'Courier New', monospace;">
        <table class="table">
          {% for each_release in current_releases %}
            <tr>
              <td>
                <a href="https://github.com/kizniche/Mycodo/releases/tag/v{{ each_release }}" target="_blank" {% if current_release == each_release %}style="color: red"{% endif %}>v{{ each_release }}</a>
              </td>
            </tr>
          {% endfor %}
        </table>
      </div>
    {% endif %}
  </div>

{% endblock %}
